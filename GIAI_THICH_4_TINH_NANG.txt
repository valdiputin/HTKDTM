================================================================================
                GIẢI THÍCH CHI TIẾT 4 TÍNH NĂNG ĐÃ TRIỂN KHAI
================================================================================

Mục lục:
1. CourseDetailActivity với danh sách bài giảng YouTube
2. Tích hợp YouTube Player
3. Dashboard theo dõi tiến độ
4. Lưu/đọc tiến độ học tập

================================================================================
1. COURSEDETAILACTIVITY VỚI DANH SÁCH BÀI GIẢNG YOUTUBE
================================================================================

Mô tả:
--------
Màn hình hiển thị chi tiết khóa học, bao gồm thông tin khóa học và danh sách 
bài giảng có thể xem trực tiếp từ YouTube.

File đã tạo/chỉnh sửa:
--------
- CourseDetailActivity.kt (File mới)
  Vị trí: app/src/main/java/vn/edu/tlu/cse/ht1/lequocthinh/kdtm/CourseDetailActivity.kt
  
- activity_course_detail.xml (File mới)
  Vị trí: app/src/main/res/layout/activity_course_detail.xml
  
- item_lesson.xml (File mới)
  Vị trí: app/src/main/res/layout/item_lesson.xml
  
- LessonAdapter.kt (File mới)
  Vị trí: app/src/main/java/vn/edu/tlu/cse/ht1/lequocthinh/kdtm/adapter/LessonAdapter.kt

Chức năng chi tiết:
--------

1.1. Hiển thị thông tin khóa học:
   - Hình ảnh khóa học (dùng Glide để load ảnh từ URL)
   - Tên khóa học (title)
   - Tên giảng viên (instructor)
   - Mô tả khóa học (description)
   - Đánh giá và số lượt đánh giá (rating, reviewCount)
   - Số lượng lớp học (classCount)

1.2. Hiển thị danh sách bài giảng:
   - Load danh sách bài giảng từ Firebase Firestore
   - Hiển thị dạng RecyclerView với card view
   - Mỗi bài giảng hiển thị:
     * Tên bài giảng (title)
     * Thời lượng (duration)
     * Icon tích (✓) nếu đã hoàn thành
   
1.3. Logic load dữ liệu:
   - Nhận courseId từ Intent
   - Gọi FirebaseService.getCourseById() để lấy thông tin khóa học
   - Gọi FirebaseService để lấy danh sách lessons từ subcollection 
     "courses/{courseId}/lessons"
   - Kiểm tra lesson nào đã hoàn thành (từ studyHistory của user)
   - Hiển thị trạng thái hoàn thành bằng icon ✓

1.4. Cấu trúc dữ liệu trong Firebase:
   Collection: courses
     Document: {courseId}
       - title, description, imageUrl, instructor, ...
       Subcollection: lessons
         Document: {lessonId}
           - title, description, youtubeVideoId, youtubeUrl, duration, order

Cách sử dụng:
--------
- Từ HomeActivity, khi user click vào một course card
- Intent được gửi với "courseId" extra
- CourseDetailActivity nhận courseId và load dữ liệu từ Firebase
- User có thể scroll để xem tất cả bài giảng
- Click vào bài giảng sẽ mở YouTube (xem phần 2)

================================================================================
2. TÍCH HỢP YOUTUBE PLAYER
================================================================================

Mô tả:
--------
Khi user click vào một bài giảng, app sẽ mở video YouTube bằng app YouTube 
hoặc trình duyệt web.

File đã tạo/chỉnh sửa:
--------
- CourseDetailActivity.kt (đã cập nhật method openYouTubeVideo())
- Lesson.kt (đã thêm method getVideoId())

Cách hoạt động:
--------

2.1. Extract Video ID từ URL:
   - Lesson model có 2 trường:
     * youtubeVideoId: Video ID trực tiếp (vd: "dQw4w9WgXcQ")
     * youtubeUrl: Full URL (vd: "https://www.youtube.com/watch?v=dQw4w9WgXcQ")
   
   - Method getVideoId() trong Lesson.kt:
     * Ưu tiên dùng youtubeVideoId nếu có
     * Nếu không, extract từ youtubeUrl:
       - "youtu.be/XXXXX" → lấy XXXXX
       - "youtube.com/watch?v=XXXXX" → lấy XXXXX

2.2. Mở YouTube video:
   - Method openYouTubeVideo() trong CourseDetailActivity.kt:
     * Thử mở YouTube app trước: "vnd.youtube:{videoId}"
     * Nếu không có YouTube app → fallback sang browser: 
       "https://www.youtube.com/watch?v={videoId}"
     * Nếu không có videoId → mở trực tiếp youtubeUrl

2.3. Lưu lại lesson đã click:
   - Biến lastClickedLessonId lưu ID của lesson vừa click
   - Khi user quay lại app (onResume), lesson sẽ được đánh dấu hoàn thành
   - Logic này được xử lý ở phần 4 (Lưu/đọc tiến độ học tập)

Ưu điểm:
--------
- Không cần embed YouTube player phức tạp
- User có thể dùng full features của YouTube app (like, comment, subscribe)
- Tiết kiệm bandwidth cho app
- Tương thích với mọi thiết bị Android có YouTube app hoặc browser

================================================================================
3. DASHBOARD THEO DÕI TIẾN ĐỘ
================================================================================

Mô tả:
--------
Màn hình "Cá nhân" (ProfileActivity) hiển thị dashboard với các thống kê 
về tiến độ học tập của user.

File đã tạo/chỉnh sửa:
--------
- ProfileActivity.kt (File mới)
  Vị trí: app/src/main/java/vn/edu/tlu/cse/ht1/lequocthinh/kdtm/ProfileActivity.kt
  
- activity_profile.xml (File mới/cập nhật)
  Vị trí: app/src/main/res/layout/activity_profile.xml

Các thống kê hiển thị:
--------

3.1. Điểm trung bình (Average Score):
   - Tính từ studyHistory của user
   - Công thức: (tổng điểm) / (số bài đã có điểm)
   - Chỉ tính những lesson có score > 0
   - Hiển thị: "Điểm trung bình: X.X/10"
   - Mặc định: 0.0/10 nếu chưa có điểm nào

3.2. Phần trăm hoàn thành (Completion %):
   - Công thức: (số khóa đã hoàn thành / số khóa đã đăng ký) * 100
   - Hiển thị: "X% hoàn thành"
   - ProgressBar hiển thị trực quan phần trăm này (màu #F4A100)
   - Hiển thị: "Đã hoàn thành: X khóa học"

3.3. Thời gian học (Study Time):
   - Tính tổng timeSpent từ studyHistory (đơn vị: phút)
   - Chuyển đổi sang giờ: tổng phút / 60
   - Hiển thị: "Thời gian học: X.X giờ"
   - Mặc định: 0 giờ nếu chưa học gì

3.4. Thành tích (Achievements):
   - Đếm: 
     * Số khóa học đã hoàn thành
     * Số bài có điểm >= 8.0
   - Hiển thị: "X thành tích"

3.5. Khóa học đã đăng ký (Enrolled Courses):
   - Hiển thị: "Đã đăng ký: X khóa học"

Logic tính toán:
--------
- Method calculateAndDisplayProgress() trong ProfileActivity.kt:
  1. Load tất cả courses từ Firebase
  2. Load user data từ Firebase (bao gồm studyHistory)
  3. Tính toán tất cả các chỉ số trên
  4. Update UI với các giá trị đã tính

Cấu trúc dữ liệu:
--------
- User model có:
  * completedCourses: List<String> - Danh sách courseId đã hoàn thành
  * enrolledCourses: List<String> - Danh sách courseId đã đăng ký
  * studyHistory: List<StudyProgress> - Lịch sử học tập chi tiết

Cách truy cập:
--------
- Từ HomeActivity, click vào button "Cá nhân" ở bottom navigation
- Hoặc từ bất kỳ đâu có bottom navigation với icon "Cá nhân"

================================================================================
4. LƯU/ĐỌC TIẾN ĐỘ HỌC TẬP
================================================================================

Mô tả:
--------
Hệ thống lưu trữ và đọc tiến độ học tập của user vào Firebase Firestore, 
đảm bảo dữ liệu được đồng bộ và lưu trữ bền vững.

File đã tạo/chỉnh sửa:
--------
- FirebaseService.kt (đã thêm các method)
  Vị trí: app/src/main/java/vn/edu/tlu/cse/ht1/lequocthinh/kdtm/service/FirebaseService.kt
  
- User.kt và StudyProgress.kt (Model classes)
  Vị trí: app/src/main/java/vn/edu/tlu/cse/ht1/lequocthinh/kdtm/model/User.kt
  
- CourseDetailActivity.kt (đã cập nhật logic lưu tiến độ)
- ProfileActivity.kt (đã cập nhật logic đọc tiến độ)

Cấu trúc dữ liệu trong Firebase:
--------

Collection: users
  Document: {userId}
    Fields:
      - id: String
      - name: String
      - email: String
      - role: String ("student" hoặc "lecturer")
      - completedCourses: List<String> (các courseId)
      - enrolledCourses: List<String> (các courseId)
      - interests: List<String>
    
    Subcollection: progress
      Document: {autoId}
        Fields:
          - courseId: String
          - lessonId: String
          - completedAt: Long (timestamp milliseconds)
          - score: Double (điểm số, 0.0 nếu chưa có điểm)
          - timeSpent: Long (thời gian học tính bằng phút)

Các method trong FirebaseService:
--------

4.1. markLessonCompleted(userId, courseId, lessonId):
   - Mục đích: Đánh dấu một lesson đã hoàn thành
   - Cách hoạt động:
     1. Tạo StudyProgress object với:
        * courseId và lessonId từ tham số
        * completedAt = thời gian hiện tại (System.currentTimeMillis())
        * score = 0.0 (mặc định, có thể cập nhật sau)
        * timeSpent = 0 (mặc định, có thể cập nhật sau)
     2. Thêm vào subcollection "users/{userId}/progress"
   - Được gọi từ: CourseDetailActivity.onResume()

4.2. getUserById(userId):
   - Mục đích: Lấy thông tin user và studyHistory từ Firebase
   - Cách hoạt động:
     1. Lấy user document từ "users/{userId}"
     2. Lấy tất cả documents từ "users/{userId}/progress"
     3. Map thành List<StudyProgress>
     4. Trả về User object với studyHistory đầy đủ
   - Được gọi từ: 
     * ProfileActivity.loadUserData()
     * CourseDetailActivity.displayLessons()

4.3. updateUserProgress(userId, progress):
   - Mục đích: Thêm một StudyProgress vào Firebase
   - Cách hoạt động:
     1. Thêm document vào "users/{userId}/progress"
     2. Firebase tự động generate document ID
   - Được gọi từ: markLessonCompleted()

Logic lưu tiến độ khi xem video:
--------

4.4. Flow trong CourseDetailActivity:
   
   Bước 1: User click vào lesson
   - LessonAdapter gọi onLessonClick callback
   - Lưu lesson.id vào biến lastClickedLessonId
   - Gọi openYouTubeVideo() để mở YouTube
   
   Bước 2: User mở YouTube (app rời khỏi CourseDetailActivity)
   - App chuyển sang YouTube app hoặc browser
   
   Bước 3: User quay lại app (onResume được gọi)
   - Kiểm tra nếu lastClickedLessonId không rỗng
   - Lấy currentUser từ FirebaseService.getCurrentUser()
   - Load user data từ Firebase để check lesson đã completed chưa
   - Nếu chưa completed:
     * Gọi FirebaseService.markLessonCompleted()
     * Reload lessons để update UI (hiển thị icon ✓)
   - Reset lastClickedLessonId = ""

Lý do thiết kế này:
--------
- Chỉ đánh dấu hoàn thành khi user thực sự quay lại app (đã xem video)
- Tránh đánh dấu hoàn thành nếu user chỉ click nhưng không xem
- Đảm bảo dữ liệu chính xác hơn

Logic đọc tiến độ trong ProfileActivity:
--------

4.5. Flow trong ProfileActivity:
   
   Bước 1: Load user data
   - Gọi FirebaseService.getUserById(currentUser.uid)
   - Nhận về User object với studyHistory đầy đủ
   
   Bước 2: Tính toán các chỉ số
   - Dựa vào:
     * user.studyHistory để tính điểm trung bình
     * user.completedCourses để đếm khóa đã hoàn thành
     * user.enrolledCourses để đếm khóa đã đăng ký
     * user.studyHistory để tính tổng thời gian học
   
   Bước 3: Hiển thị lên UI
   - Update các TextView với giá trị đã tính
   - Update ProgressBar với phần trăm hoàn thành

Logic đọc tiến độ trong CourseDetailActivity:
--------

4.6. Flow khi hiển thị danh sách lessons:
   
   Bước 1: Load course và lessons từ Firebase
   
   Bước 2: Load user's studyHistory
   - Gọi FirebaseService.getUserById(currentUser.uid)
   - Lấy danh sách lessonId đã completed từ studyHistory
   
   Bước 3: Mark lessons as completed
   - Duyệt qua danh sách lessons
   - Nếu lesson.id có trong studyHistory → đánh dấu isCompleted = true
   - Ngược lại → isCompleted = false
   
   Bước 4: Hiển thị với LessonAdapter
   - Adapter sẽ hiển thị icon ✓ cho lessons đã completed

Security Rules trong Firestore:
--------
Đã cấu hình trong firestore.rules:
- Users chỉ đọc/ghi được document của chính mình
- Progress chỉ được đọc/ghi bởi user sở hữu
- Courses có thể đọc bởi mọi user, chỉ ghi khi đã đăng nhập

================================================================================
                          TỔNG KẾT VÀ KẾT NỐI
================================================================================

Cách 4 tính năng kết nối với nhau:
--------

1. User vào HomeActivity → xem danh sách courses
2. Click vào course → CourseDetailActivity hiển thị:
   - Thông tin course
   - Danh sách lessons với trạng thái hoàn thành (từ phần 4)
3. Click vào lesson → Mở YouTube (phần 2)
4. Quay lại app → Lesson được đánh dấu hoàn thành (phần 4)
5. Vào ProfileActivity → Xem dashboard (phần 3):
   - Điểm trung bình (từ studyHistory)
   - Phần trăm hoàn thành (từ completedCourses/enrolledCourses)
   - Thời gian học (từ studyHistory.timeSpent)
   - Thành tích (từ completedCourses + high scores)

Dependencies đã thêm:
--------
- Firebase Firestore (để lưu/đọc dữ liệu)
- Firebase Auth (để xác thực user)
- Glide (để load ảnh)
- Coroutines (để xử lý async operations)
- RecyclerView, CardView (để hiển thị danh sách)

Cấu trúc thư mục:
--------
app/src/main/
  java/vn/edu/tlu/cse/ht1/lequocthinh/kdtm/
    ├── CourseDetailActivity.kt
    ├── ProfileActivity.kt
    ├── adapter/
    │   └── LessonAdapter.kt
    ├── model/
    │   ├── Lesson.kt
    │   └── User.kt (bao gồm StudyProgress)
    └── service/
        └── FirebaseService.kt

  res/layout/
    ├── activity_course_detail.xml
    ├── activity_profile.xml
    └── item_lesson.xml

================================================================================
                              HẾT TÀI LIỆU
================================================================================

